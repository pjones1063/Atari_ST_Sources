;************************************************************************
;
;               Autor:                  Kay R”mer
;               Purpose:                2 voice Yamaha sample player
;               Date:                   jul 31 1992 / aug 1 1992
;               Time:                   21.00 - 01.00
;
;************************************************************************


tacr            EQU $FFFFFA19
vr              EQU $FFFFFA17
giread          EQU $FFFF8800
giselect        EQU giread
giwrite         EQU $FFFF8802

dispatch:

                pea     _on(PC)
                move.w  #$26,-(SP)
                trap    #14
                addq.l  #6,SP
                rts
_on:

                move.b  #0,tacr.w

                move.l  _channels(PC,D5.w),D3
                lea     _ends(PC),A0
                move.l  D6,8(A0,D3.w)
                move.l  D7,0(A0,D3.w)

                move.l  _ends(PC),D3
                sub.l   _adresses(PC),D3
                move.l  _ends+4(PC),D4
                sub.l   _adresses+4(PC),D4
                cmp.l   D3,D4
                bcc.s   _noswap

                lea     _channels(PC),A0
                movem.l (A0),D0-D5
                exg     D0,D1
                exg     D2,D3
                exg     D4,D5
                movem.l D0-D5,(A0)
_noswap:
                move.b  #4,tacr.w
                rts

_channels:      DC.L 0
                DC.L 4

_ends:          DC.L 0
                DC.L 0

_adresses:      DC.L 0
                DC.L 0

_zero:          DC.L 0

;**********************************************************************
;
;               Initialisierung von Timer A & Soundchip
;
;               IN:     NIX
;               OUT:    NIX
;
;**********************************************************************

init:
                lea     _ends(PC),A0
                lea     _zero(PC),A1
                move.l  A1,(A0)+
                move.l  A1,(A0)+
                move.l  A1,(A0)+
                move.l  A1,(A0)+

                pea     _install(PC)
                move.w  #$26,-(SP)
                trap    #14
                addq.l  #6,SP

                pea     player(PC)
                move.w  #8,-(SP)
                move.l  #4,-(SP)
                move.w  #$1F,-(SP)
                trap    #14
                lea     12(SP),SP
                rts

_install:

                move.b  #7,giselect.w   ;MIX - Control anw„hlen

                ori.b   #$3F,giwrite.w  ;setzt Bits 0 bis einschl. 5
                rts

;**********************************************************************
;
;               Abspielroutine, verbraucht bei 6kHz 22% der
;               Rechenzeit eines 8MHz ST
;
;               IN:     NIX
;               OUT:    NIX
;
;**********************************************************************


player:         movem.l D0/A0-A1,-(SP)
                lea     _adresses(PC),A0
                moveq   #0,D0
                movea.l (A0)+,A1
                move.b  (A1)+,D0
                beq.s   _stopa
                move.l  A1,-4(A0)
                movea.l (A0),A1
                add.b   (A1)+,D0
                roxr.b  #1,D0
                bne.s   _stopb
                bcs.s   _stopb
                bra.s   _ende
_stopa:         movea.l (A0),A1
                move.b  (A1)+,D0
                bne.s   _stopb
_ende:          clr.b   tacr.w
                movem.l (SP)+,D0/A0-A1
                rte
_stopb:         lsl.w   #4,D0
                move.l  A1,(A0)
                movem.l _sound(PC,D0.w),D0/A0-A1
                movem.l D0/A0-A1,giread.w
                movem.l (SP)+,D0/A0-A1
                rte


_sound:
                DC.L $08000E00,$09000D00,$0A000C00,0,$08000F00,$09000300,$0A000000,0
                DC.L $08000F00,$09000300,$0A000000,0,$08000F00,$09000300,$0A000000,0
                DC.L $08000F00,$09000300,$0A000000,0,$08000F00,$09000300,$0A000000,0
                DC.L $08000F00,$09000300,$0A000000,0,$08000E00,$09000D00,$0A000B00,0
                DC.L $08000E00,$09000D00,$0A000B00,0,$08000E00,$09000D00,$0A000B00,0
                DC.L $08000E00,$09000D00,$0A000B00,0,$08000E00,$09000D00,$0A000B00,0
                DC.L $08000E00,$09000D00,$0A000B00,0,$08000E00,$09000D00,$0A000B00,0
                DC.L $08000E00,$09000D00,$0A000A00,0,$08000E00,$09000D00,$0A000A00,0
                DC.L $08000E00,$09000D00,$0A000A00,0,$08000E00,$09000D00,$0A000A00,0
                DC.L $08000E00,$09000C00,$0A000C00,0,$08000E00,$09000D00,$0A000000,0
                DC.L $08000D00,$09000D00,$0A000D00,0,$08000D00,$09000D00,$0A000D00,0
                DC.L $08000D00,$09000D00,$0A000D00,0,$08000D00,$09000D00,$0A000D00,0
                DC.L $08000D00,$09000D00,$0A000D00,0,$08000D00,$09000D00,$0A000D00,0
                DC.L $08000E00,$09000C00,$0A000B00,0,$08000E00,$09000C00,$0A000B00,0
                DC.L $08000E00,$09000C00,$0A000B00,0,$08000E00,$09000C00,$0A000B00,0
                DC.L $08000E00,$09000C00,$0A000B00,0,$08000E00,$09000C00,$0A000B00,0
                DC.L $08000E00,$09000C00,$0A000B00,0,$08000E00,$09000C00,$0A000B00,0
                DC.L $08000E00,$09000C00,$0A000A00,0,$08000E00,$09000C00,$0A000A00,0
                DC.L $08000E00,$09000C00,$0A000A00,0,$08000E00,$09000C00,$0A000A00,0
                DC.L $08000D00,$09000D00,$0A000C00,0,$08000D00,$09000D00,$0A000C00,0
                DC.L $08000E00,$09000C00,$0A000900,0,$08000E00,$09000C00,$0A000900,0
                DC.L $08000E00,$09000C00,$0A000500,0,$08000E00,$09000C00,$0A000000,0
                DC.L $08000E00,$09000C00,$0A000000,0,$08000E00,$09000B00,$0A000B00,0
                DC.L $08000E00,$09000B00,$0A000B00,0,$08000E00,$09000B00,$0A000B00,0
                DC.L $08000E00,$09000B00,$0A000B00,0,$08000E00,$09000B00,$0A000A00,0
                DC.L $08000E00,$09000B00,$0A000A00,0,$08000E00,$09000B00,$0A000A00,0
                DC.L $08000D00,$09000D00,$0A000B00,0,$08000D00,$09000D00,$0A000B00,0
                DC.L $08000D00,$09000D00,$0A000B00,0,$08000E00,$09000B00,$0A000900,0
                DC.L $08000E00,$09000B00,$0A000900,0,$08000E00,$09000B00,$0A000900,0
                DC.L $08000D00,$09000C00,$0A000C00,0,$08000D00,$09000D00,$0A000A00,0
                DC.L $08000E00,$09000B00,$0A000700,0,$08000E00,$09000B00,$0A000000,0
                DC.L $08000E00,$09000B00,$0A000000,0,$08000D00,$09000D00,$0A000900,0
                DC.L $08000D00,$09000D00,$0A000900,0,$08000E00,$09000A00,$0A000900,0
                DC.L $08000D00,$09000D00,$0A000800,0,$08000D00,$09000D00,$0A000700,0
                DC.L $08000D00,$09000D00,$0A000400,0,$08000D00,$09000D00,$0A000000,0
                DC.L $08000E00,$09000A00,$0A000400,0,$08000E00,$09000900,$0A000900,0
                DC.L $08000E00,$09000900,$0A000900,0,$08000D00,$09000C00,$0A000B00,0
                DC.L $08000E00,$09000900,$0A000800,0,$08000E00,$09000900,$0A000800,0
                DC.L $08000E00,$09000900,$0A000700,0,$08000E00,$09000800,$0A000800,0
                DC.L $08000E00,$09000900,$0A000100,0,$08000C00,$09000C00,$0A000C00,0
                DC.L $08000D00,$09000C00,$0A000A00,0,$08000E00,$09000800,$0A000600,0
                DC.L $08000E00,$09000700,$0A000700,0,$08000E00,$09000800,$0A000000,0
                DC.L $08000E00,$09000700,$0A000500,0,$08000E00,$09000600,$0A000600,0
                DC.L $08000D00,$09000C00,$0A000900,0,$08000E00,$09000500,$0A000500,0
                DC.L $08000E00,$09000400,$0A000400,0,$08000D00,$09000C00,$0A000800,0
                DC.L $08000D00,$09000B00,$0A000B00,0,$08000E00,$09000000,$0A000000,0
                DC.L $08000D00,$09000C00,$0A000600,0,$08000D00,$09000C00,$0A000500,0
                DC.L $08000D00,$09000C00,$0A000200,0,$08000C00,$09000C00,$0A000B00,0
                DC.L $08000C00,$09000C00,$0A000B00,0,$08000D00,$09000B00,$0A000A00,0
                DC.L $08000D00,$09000B00,$0A000A00,0,$08000D00,$09000B00,$0A000A00,0
                DC.L $08000D00,$09000B00,$0A000A00,0,$08000C00,$09000C00,$0A000A00,0
                DC.L $08000C00,$09000C00,$0A000A00,0,$08000C00,$09000C00,$0A000A00,0
                DC.L $08000D00,$09000B00,$0A000900,0,$08000D00,$09000B00,$0A000900,0
                DC.L $08000D00,$09000A00,$0A000A00,0,$08000D00,$09000A00,$0A000A00,0
                DC.L $08000D00,$09000A00,$0A000A00,0,$08000C00,$09000C00,$0A000900,0
                DC.L $08000C00,$09000C00,$0A000900,0,$08000C00,$09000C00,$0A000900,0
                DC.L $08000D00,$09000B00,$0A000600,0,$08000C00,$09000B00,$0A000B00,0
                DC.L $08000C00,$09000C00,$0A000800,0,$08000D00,$09000B00,$0A000000,0
                DC.L $08000D00,$09000B00,$0A000000,0,$08000C00,$09000C00,$0A000700,0
                DC.L $08000C00,$09000C00,$0A000600,0,$08000C00,$09000C00,$0A000500,0
                DC.L $08000C00,$09000C00,$0A000300,0,$08000C00,$09000C00,$0A000100,0
                DC.L $08000C00,$09000B00,$0A000A00,0,$08000D00,$09000A00,$0A000500,0
                DC.L $08000D00,$09000A00,$0A000400,0,$08000D00,$09000A00,$0A000200,0
                DC.L $08000D00,$09000900,$0A000800,0,$08000D00,$09000900,$0A000800,0
                DC.L $08000C00,$09000B00,$0A000900,0,$08000C00,$09000B00,$0A000900,0
                DC.L $08000D00,$09000800,$0A000800,0,$08000B00,$09000B00,$0A000B00,0
                DC.L $08000D00,$09000900,$0A000500,0,$08000C00,$09000B00,$0A000800,0
                DC.L $08000D00,$09000900,$0A000200,0,$08000D00,$09000800,$0A000600,0
                DC.L $08000C00,$09000B00,$0A000700,0,$08000D00,$09000700,$0A000700,0
                DC.L $08000C00,$09000B00,$0A000600,0,$08000C00,$09000A00,$0A000900,0
                DC.L $08000B00,$09000B00,$0A000A00,0,$08000C00,$09000B00,$0A000200,0
                DC.L $08000C00,$09000B00,$0A000000,0,$08000C00,$09000A00,$0A000800,0
                DC.L $08000D00,$09000600,$0A000400,0,$08000D00,$09000500,$0A000500,0
                DC.L $08000D00,$09000500,$0A000400,0,$08000C00,$09000900,$0A000900,0
                DC.L $08000D00,$09000400,$0A000300,0,$08000B00,$09000B00,$0A000900,0
                DC.L $08000C00,$09000A00,$0A000500,0,$08000B00,$09000A00,$0A000A00,0
                DC.L $08000C00,$09000900,$0A000800,0,$08000B00,$09000B00,$0A000800,0
                DC.L $08000C00,$09000A00,$0A000000,0,$08000C00,$09000A00,$0A000000,0
                DC.L $08000C00,$09000900,$0A000700,0,$08000B00,$09000B00,$0A000700,0
                DC.L $08000C00,$09000900,$0A000600,0,$08000B00,$09000B00,$0A000600,0
                DC.L $08000B00,$09000A00,$0A000900,0,$08000B00,$09000B00,$0A000500,0
                DC.L $08000A00,$09000A00,$0A000A00,0,$08000B00,$09000B00,$0A000200,0
                DC.L $08000B00,$09000A00,$0A000800,0,$08000C00,$09000700,$0A000700,0
                DC.L $08000C00,$09000800,$0A000400,0,$08000C00,$09000700,$0A000600,0
                DC.L $08000B00,$09000900,$0A000900,0,$08000C00,$09000600,$0A000600,0
                DC.L $08000A00,$09000A00,$0A000900,0,$08000C00,$09000700,$0A000300,0
                DC.L $08000B00,$09000A00,$0A000500,0,$08000B00,$09000900,$0A000800,0
                DC.L $08000B00,$09000A00,$0A000300,0,$08000A00,$09000A00,$0A000800,0
                DC.L $08000B00,$09000A00,$0A000000,0,$08000B00,$09000900,$0A000700,0
                DC.L $08000B00,$09000800,$0A000800,0,$08000A00,$09000A00,$0A000700,0
                DC.L $08000A00,$09000900,$0A000900,0,$08000C00,$09000100,$0A000100,0
                DC.L $08000A00,$09000A00,$0A000600,0,$08000B00,$09000800,$0A000700,0
                DC.L $08000A00,$09000A00,$0A000500,0,$08000A00,$09000900,$0A000800,0
                DC.L $08000A00,$09000A00,$0A000200,0,$08000A00,$09000A00,$0A000100,0
                DC.L $08000A00,$09000A00,$0A000000,0,$08000900,$09000900,$0A000900,0
                DC.L $08000A00,$09000800,$0A000800,0,$08000B00,$09000800,$0A000100,0
                DC.L $08000A00,$09000900,$0A000600,0,$08000B00,$09000700,$0A000400,0
                DC.L $08000A00,$09000900,$0A000500,0,$08000900,$09000900,$0A000800,0
                DC.L $08000A00,$09000900,$0A000300,0,$08000A00,$09000800,$0A000600,0
                DC.L $08000A00,$09000900,$0A000000,0,$08000900,$09000900,$0A000700,0
                DC.L $08000900,$09000800,$0A000800,0,$08000A00,$09000800,$0A000400,0
                DC.L $08000900,$09000900,$0A000600,0,$08000A00,$09000800,$0A000100,0
                DC.L $08000900,$09000900,$0A000500,0,$08000900,$09000800,$0A000700,0
                DC.L $08000800,$09000800,$0A000800,0,$08000900,$09000900,$0A000200,0
                DC.L $08000900,$09000800,$0A000600,0,$08000900,$09000900,$0A000000,0
                DC.L $08000900,$09000700,$0A000700,0,$08000800,$09000800,$0A000700,0
                DC.L $08000900,$09000700,$0A000600,0,$08000900,$09000800,$0A000200,0
                DC.L $08000800,$09000800,$0A000600,0,$08000900,$09000600,$0A000600,0
                DC.L $08000800,$09000700,$0A000700,0,$08000800,$09000800,$0A000400,0
                DC.L $08000800,$09000700,$0A000600,0,$08000800,$09000800,$0A000200,0
                DC.L $08000700,$09000700,$0A000700,0,$08000800,$09000600,$0A000600,0
                DC.L $08000800,$09000700,$0A000400,0,$08000700,$09000700,$0A000600,0
                DC.L $08000800,$09000600,$0A000500,0,$08000800,$09000600,$0A000400,0
                DC.L $08000700,$09000600,$0A000600,0,$08000700,$09000700,$0A000400,0
                DC.L $08000800,$09000500,$0A000400,0,$08000600,$09000600,$0A000600,0
                DC.L $08000700,$09000600,$0A000400,0,$08000700,$09000500,$0A000500,0
                DC.L $08000600,$09000600,$0A000500,0,$08000600,$09000600,$0A000400,0
                DC.L $08000600,$09000500,$0A000500,0,$08000600,$09000600,$0A000200,0
                DC.L $08000600,$09000500,$0A000400,0,$08000500,$09000500,$0A000500,0
                DC.L $08000600,$09000500,$0A000200,0,$08000500,$09000500,$0A000400,0
                DC.L $08000500,$09000400,$0A000400,0,$08000500,$09000500,$0A000200,0
                DC.L $08000400,$09000400,$0A000400,0,$08000400,$09000400,$0A000300,0
                DC.L $08000400,$09000400,$0A000200,0,$08000400,$09000300,$0A000300,0
                DC.L $08000300,$09000300,$0A000300,0,$08000300,$09000300,$0A000200,0
                DC.L $08000300,$09000200,$0A000200,0,$08000200,$09000200,$0A000200,0
                DC.L $08000200,$09000200,$0A000100,0,$08000100,$09000100,$0A000100,0
                DC.L $08000200,$09000100,$0A000000,0,$08000100,$09000100,$0A000000,0
                DC.L $08000100,$09000000,$0A000000,0,$08000000,$09000000,$0A000000,0


                END
