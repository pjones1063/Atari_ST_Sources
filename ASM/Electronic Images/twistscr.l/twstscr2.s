* THE TWIST SCROLL 2
* By Martin Griffiths Nov-Dec '89.

		OPT O+,OW-

Twist_scr2	CLR.L -(SP)
		MOVE #$20,-(sp)
		TRAP #1
		ADDQ.L #6,SP
		MOVE.L D0,oldssp
		MOVE #$2700,SR
		LEA $6A000,SP
Clear_scrns	MOVE.L log_base(PC),A0
		MOVEQ #0,D1
		MOVE #12239,D0
cl_lp		MOVE.L D1,(A0)+
		MOVE.L D1,(A0)+
		DBF D0,cl_lp	
set_pal	MOVE #$8240,A0
		MOVE.L #$00000011,(A0)+
		MOVE.L #$01220233,(A0)+
		MOVE.L #$01100221,(A0)+
		MOVE.L #$03320100,(A0)+
		MOVE.L #$02110322,(A0)+
		MOVE.L #$00100121,(A0)+
		MOVE.L #$02320444,(A0)+
		MOVE.L #$03330555,(A0)+

* Table for 32*32 font

make1_tab	LEA char_tab1+128(PC),A0
		LEA font32,A1 
		MOVEQ #0,D0
		MOVEQ #59,D1
makec1_lp	MOVE.L A1,(A0)+
		LEA 512(A1),A1
		DBF D1,makec1_lp 

* This Routine creates the diagonal
* fonts by shifting left two pixels
* up one from the previous.

Makefonts	LEA FONT1,A0
		MOVE #8639,D0
		MOVEQ #0,D1 
clrb_lp	MOVE.L D1,(A0)+
		MOVE.L D1,(A0)+
		DBF D0,clrb_lp
		LEA FONT1,A1		first copy
		MOVEQ #7,D7
		MOVEQ #32,D0
		MOVEQ #0,D4
Make_lp	LEA buffer,A0		original font
Movefont	MOVEQ #59,D1		60 chars
Copyfont1	LEA (A1,D0),A2		add line offset
		MOVEQ #35,D2		36 lines
Copyfont2	MOVEQ #0,D5
		MOVE (A0)+,D5
		LSL.L D4,D5			shift by d4
		MOVE.L D5,(A2)+
		DBF D2,Copyfont2		
		LEA 144(A1),A1
		DBF D1,Copyfont1
		SUBQ #4,D0			offset-4
		ADDQ #2,D4			shift+2
		DBF D7,Make_lp
clear_buff	LEA buffer,A0
		MOVEQ #0,D1
		MOVE #999,D0
cb_lp		MOVE.L D1,(A0)+
		DBF D0,cb_lp	
Lettab_make	LEA Char_offset+64(PC),A0
		MOVEQ #0,D0
		MOVEQ #59,D1
tab_lp	MOVE D0,(A0)+
		ADD #144,D0
		DBF D1,tab_lp

* Pre-shift the Resistance sprites
* so they are hyper fast...

Pre_shift	LEA sprite_buf,A0
		LEA sprites,A2
		MOVEQ #9,D5
spr_lp	MOVEQ #0,D6
sh_lp		MOVE.L A2,A1
		MOVEQ #15,D7
li_lp		MOVEQ #0,D0
		MOVEQ #0,D1
		MOVEQ #-1,D2
		MOVE (A1)+,D0
		MOVE (A1)+,D1
		MOVE D0,D2
		OR D1,D2
		NOT D2
		ROR.L D6,D0
		ROR.L D6,D1
		ROR.L D6,D2
		MOVE D2,(A0)+
		MOVE D2,(A0)+
		MOVE D0,(A0)+
		MOVE D1,(A0)+
		SWAP D1
		MOVE D1,D0
		SWAP D2
		MOVE D2,(A0)+
		MOVE D2,(A0)+
		MOVE.L D0,(A0)+
		DBF D7,li_lp	
		ADDQ #1,D6
		CMP #16,D6
		BNE.S sh_lp
		LEA 64(A2),A2
		DBF D5,spr_lp

Move_logo	LEA twist_logo,A0
		MOVE.L log_base(PC),A1
		MOVE.L phy_base(PC),A2
		MOVE #1199,D0
cpylogo_lp	MOVE.L (A0),(A1)+
		MOVE.L (A0)+,(A2)+
		DBF D0,cpylogo_lp
Move_led	LEA led(PC),A0
		MOVE.L log_base(PC),A1
		MOVE.L phy_base(PC),A2
		ADD.L #37600,A1
		ADD.L #37600,A2
		MOVE #959,D0
cpyled_lp	MOVE.L (A0),(A1)+
		MOVE.L (A0)+,(A2)+
		DBF D0,cpyled_lp
interrupts	BSR flush
		MOVE.B #$12,$FFFFFC02.W
		LEA old_mfp,A0
		MOVE.L $FFFF8200.W,old_base
		MOVE.B $FFFFFA07.W,(A0)+
		MOVE.B $FFFFFA09.W,(A0)+
		MOVE.B $FFFFFA13.W,(A0)+
		MOVE.B $FFFFFA15.W,(A0)+
		MOVE.B $FFFFFA17.W,(A0)+
		MOVE.B $FFFFFA1B.W,(A0)+
		MOVE.B $FFFFFA21.W,(A0)+
		MOVE.L #hbl_1,$120.W
		MOVE.B #01,$FFFFFA07.W
		MOVE.B #00,$FFFFFA09.W
		MOVE.B #01,$FFFFFA13.W
		MOVE.B #00,$FFFFFA15.W
		MOVE.B #00,$FFFFFA1B.W
		MOVE.B #00,$FFFFFA21.W
		BCLR.B #3,$FFFFFA17.W
vbl_install	MOVE.L $70.W,old_vbl
		MOVE.L #my_vbl,$70.W
init_mus	MOVEQ #2,D0
		JSR mus
		MOVE #$2300,SR

* Main program loop.

VBLOOP	LEA log_base(PC),A0
		MOVE.L (A0)+,D0
		MOVE.L (A0)+,D1
		MOVE.L D0,-(A0)
		MOVE.L D1,-(A0)
		LSR #8,D0
		MOVE.L D0,$FFFF8200.W
wait_vbl	MOVE vbl_tmr(PC),D0
wait_vblp	CMP vbl_tmr(PC),D0
		BEQ.S wait_vblp
		MOVE.L Fonttype(PC),A0
		LEA 8640(A0),A0
		CMP.L #FONTEND,A0
		BNE.S CONT
		LEA FONT1,A0
		ADDQ.L #1,Scr_point
		MOVE.L Scr_point(PC),A6
		TST.B 22(A6)
		BNE.S CONT
		MOVE.L #Scrolline,Scr_point

CONT		MOVE.L A0,Fonttype
		LEA buffer,A1		
		LEA 12(A1),A3
		LEA Char_offset(PC),A4
		MOVE.L A0,A5
		MOVE.L Scr_point(PC),A6
		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
i		SET 34
j		SET 0
		REPT 29
		MOVE i(A0),j(A1)
i		SET i+4
j		SET j+40
		ENDR 
first_sec	MOVEQ #5,D7
sec1_lp	MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,960(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,962(A1)
		OR D1,1000(A1)
		MOVE D2,1002(A1)
		OR D3,1040(A1)
		MOVE D4,1042(A1)
		OR D5,1080(A1)
		MOVE D6,1082(A1)
		MOVEM.W (A0)+,D0-D1
		OR D0,1120(A1)
		MOVE D1,1122(A1)
		MOVE.L (A0)+,1160(A1)
		MOVE.L (A0)+,1200(A1)
		MOVE.L (A0)+,1240(A1)
		MOVE.L (A0)+,1280(A1)
		MOVE.L (A0)+,1320(A1)
		MOVE.L (A0)+,1360(A1)
		MOVE.L (A0)+,1400(A1)
		MOVE.L (A0)+,1440(A1)
		LEA 322(A1),A1
		DBF D7,sec1_lp

		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,960(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,962(A1)
		OR D1,1000(A1)
		MOVE D2,1002(A1)
		OR D3,1040(A1)
		MOVE D4,1042(A1)
		OR D5,1080(A1)
		MOVE D6,1082(A1)
		MOVEM.W (A0)+,D0-D1
		OR D0,1120(A1)
		MOVE D1,1122(A1)
		MOVE.L (A0)+,1160(A1)
		MOVE.L (A0)+,1200(A1)
		MOVE.L (A0)+,1240(A1)
		MOVE.L (A0)+,(A3)
		MOVE.L (A0)+,40(A3)
		MOVE.L (A0)+,80(A3)
		MOVE.L (A0)+,120(A3)
		MOVE.L (A0)+,160(A3)
		LEA 322(A1),A1
		
		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,2(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,4(A3)
		OR D1,42(A3)
		MOVE D2,44(A3)
		OR D3,82(A3)
		MOVE D4,84(A3)
		OR D5,122(A3)
		MOVE D6,124(A3)
		MOVEM.W (A0)+,D0-D1
		OR D0,162(A3)
		MOVE D1,164(A3)
		MOVE.L (A0)+,202(A3)
		MOVE.L (A0)+,242(A3)
		MOVE.L (A0)+,282(A3)
		MOVE.L (A0)+,322(A3)
		MOVE.L (A0)+,362(A3)
		MOVE.L (A0)+,402(A3)
		MOVE.L (A0)+,442(A3)
		MOVE.L (A0)+,482(A3)
		LEA 322(A1),A1

		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,4(A3)
		MOVE D5,6(A3)
		OR D6,44(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,46(A3)
		OR D1,84(A3)
		MOVE D2,86(A3)
		OR D3,124(A3)
		MOVE D4,126(A3)
		OR D5,164(A3)
		MOVE D6,166(A3)
		MOVEM.W (A0)+,D0-D6
		OR D0,204(A3)
		MOVE D1,206(A3)
		OR D2,244(A3)
		MOVE D3,246(A3)
		OR D4,284(A3)
		MOVE D5,286(A3)
		OR D6,324(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,326(A3)
		OR D1,364(A3)
		MOVE D2,366(A3)
		OR D3,404(A3)
		MOVE D4,406(A3)
		OR D5,444(A3)
		MOVE D6,446(A3)
		MOVEM.W (A0)+,D0-D1
		OR D0,484(A3)
		MOVE D1,486(A3)
		MOVE.L (A0)+,524(A3)
		MOVE.L (A0)+,564(A3)
		MOVE.L (A0)+,604(A3)
		MOVE.L (A0)+,644(A3)
		MOVE.L (A0)+,684(A3)
		MOVE.L (A0)+,724(A3)
		MOVE.L (A0)+,764(A3)
		MOVE.L (A0)+,804(A3)
		LEA 322(A1),A1
		
		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)

		OR D2,6(A3)
		MOVE D3,8(A3)
		OR D4,46(A3)
		MOVE D5,48(A3)
		OR D6,86(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,88(A3)
		OR D1,126(A3)
		MOVE D2,128(A3)
		OR D3,166(A3)
		MOVE D4,168(A3)
		OR D5,206(A3)
		MOVE D6,208(A3)
		MOVEM.W (A0)+,D0-D6
		OR D0,246(A3)
		MOVE D1,248(A3)
		OR D2,286(A3)
		MOVE D3,288(A3)
		OR D4,326(A3)
		MOVE D5,328(A3)
		OR D6,366(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,368(A3)
		OR D1,406(A3)
		MOVE D2,408(A3)
		OR D3,446(A3)
		MOVE D4,448(A3)
		OR D5,486(A3)
		MOVE D6,488(A3)
		MOVEM.W (A0)+,D0-D6
		OR D0,526(A3)
		MOVE D1,528(A3)
		OR D2,566(A3)
		MOVE D3,568(A3)
		OR D4,606(A3)
		MOVE D5,608(A3)
		OR D6,646(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,648(A3)
		OR D1,686(A3)
		MOVE D2,688(A3)
		OR D3,726(A3)
		MOVE D4,728(A3)
		OR D5,766(A3)
		MOVE D6,768(A3)
		MOVEM.W (A0)+,D0-D1
		OR D0,806(A3)
		MOVE D1,808(A3)
		MOVE.L (A0)+,846(A3)
		MOVE.L (A0)+,886(A3)
		MOVE.L (A0)+,926(A3)
		MOVE.L (A0)+,966(A3)
		MOVE.L (A0)+,1006(A3)
		MOVE.L (A0)+,1046(A3)
		MOVE.L (A0)+,1086(A3)
		MOVE.L (A0)+,1126(A3)
		LEA 322(A1),A1

sec2		LEA 8(A3),A1
		LEA 20(A3),A3
		MOVEQ #5,D7		
sec2_lp	MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,960(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,962(A1)
		OR D1,1000(A1)
		MOVE D2,1002(A1)
		OR D3,1040(A1)
		MOVE D4,1042(A1)
		OR D5,1080(A1)
		MOVE D6,1082(A1)
		MOVEM.W (A0)+,D0-D1
		OR D0,1120(A1)
		MOVE D1,1122(A1)
		MOVE.L (A0)+,1160(A1)
		MOVE.L (A0)+,1200(A1)
		MOVE.L (A0)+,1240(A1)
		MOVE.L (A0)+,1280(A1)
		MOVE.L (A0)+,1320(A1)
		MOVE.L (A0)+,1360(A1)
		MOVE.L (A0)+,1400(A1)
		MOVE.L (A0)+,1440(A1)
		LEA 322(A1),A1
		DBF D7,sec2_lp

		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,960(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,962(A1)
		OR D1,1000(A1)
		MOVE D2,1002(A1)
		OR D3,1040(A1)
		MOVE D4,1042(A1)
		OR D5,1080(A1)
		MOVE D6,1082(A1)
		MOVEM.W (A0)+,D0-D1
		OR D0,1120(A1)
		MOVE D1,1122(A1)
		MOVE.L (A0)+,1160(A1)
		MOVE.L (A0)+,1200(A1)
		MOVE.L (A0)+,1240(A1)
		MOVE.L (A0)+,(A3)
		MOVE.L (A0)+,40(A3)
		MOVE.L (A0)+,80(A3)
		MOVE.L (A0)+,120(A3)
		MOVE.L (A0)+,160(A3)
		LEA 322(A1),A1
		
		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,640(A1)
		MOVE D5,642(A1)
		OR D6,680(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,682(A1)
		OR D1,720(A1)
		MOVE D2,722(A1)
		OR D3,760(A1)
		MOVE D4,762(A1)
		OR D5,800(A1)
		MOVE D6,802(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,840(A1)
		MOVE D1,842(A1)
		OR D2,880(A1)
		MOVE D3,882(A1)
		OR D4,920(A1)
		MOVE D5,922(A1)
		OR D6,2(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,4(A3)
		OR D1,42(A3)
		MOVE D2,44(A3)
		OR D3,82(A3)
		MOVE D4,84(A3)
		OR D5,122(A3)
		MOVE D6,124(A3)
		MOVEM.W (A0)+,D0-D1
		OR D0,162(A3)
		MOVE D1,164(A3)
		MOVE.L (A0)+,202(A3)
		MOVE.L (A0)+,242(A3)
		MOVE.L (A0)+,282(A3)
		MOVE.L (A0)+,322(A3)
		MOVE.L (A0)+,362(A3)
		MOVE.L (A0)+,402(A3)
		MOVE.L (A0)+,442(A3)
		MOVE.L (A0)+,482(A3)
		LEA 322(A1),A1

		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVEM.W (A0)+,D0-D6
		OR D0,(A1)
		MOVE D1,2(A1)
		OR D2,40(A1)
		MOVE D3,42(A1)
		OR D4,80(A1)
		MOVE D5,82(A1)
		OR D6,120(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,122(A1)
		OR D1,160(A1)
		MOVE D2,162(A1)
		OR D3,200(A1)
		MOVE D4,202(A1)
		OR D5,240(A1)
		MOVE D6,242(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,280(A1)
		MOVE D1,282(A1)
		OR D2,320(A1)
		MOVE D3,322(A1)
		OR D4,360(A1)
		MOVE D5,362(A1)
		OR D6,400(A1)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,402(A1)
		OR D1,440(A1)
		MOVE D2,442(A1)
		OR D3,480(A1)
		MOVE D4,482(A1)
		OR D5,520(A1)
		MOVE D6,522(A1)
		MOVEM.W (A0)+,D0-D6
		OR D0,560(A1)
		MOVE D1,562(A1)
		OR D2,600(A1)
		MOVE D3,602(A1)
		OR D4,4(A3)
		MOVE D5,6(A3)
		OR D6,44(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,46(A3)
		OR D1,84(A3)
		MOVE D2,86(A3)
		OR D3,124(A3)
		MOVE D4,126(A3)
		OR D5,164(A3)
		MOVE D6,166(A3)
		MOVEM.W (A0)+,D0-D6
		OR D0,204(A3)
		MOVE D1,206(A3)
		OR D2,244(A3)
		MOVE D3,246(A3)
		OR D4,284(A3)
		MOVE D5,286(A3)
		OR D6,324(A3)
		MOVEM.W (A0)+,D0-D6
		MOVE D0,326(A3)
		OR D1,364(A3)
		MOVE D2,366(A3)
		OR D3,404(A3)
		MOVE D4,406(A3)
		OR D5,444(A3)
		MOVE D6,446(A3)
		MOVEM.W (A0)+,D0-D1
		OR D0,484(A3)
		MOVE D1,486(A3)
		MOVE.L (A0)+,524(A3)
		MOVE.L (A0)+,564(A3)
		MOVE.L (A0)+,604(A3)
		MOVE.L (A0)+,644(A3)
		MOVE.L (A0)+,684(A3)
		MOVE.L (A0)+,724(A3)
		MOVE.L (A0)+,764(A3)
		MOVE.L (A0)+,804(A3)
		LEA 322(A1),A1

		MOVE.L A5,A0
		MOVEQ #0,D6
		MOVE.B (A6)+,D6
		ADD D6,D6
		ADD (A4,D6),A0
		MOVE (A0),D5
		OR D5,(A1)
		MOVE 4(A0),D5
		OR D5,40(A1)
		MOVE 8(A0),D5
		OR D5,80(A1)
		MOVE 12(A0),D5
		OR D5,120(A1)
		MOVE 16(A0),D5
		OR D5,160(A1)
		MOVE 20(A0),D5
		OR D5,200(A1)
		MOVE 24(A0),D5
		OR D5,240(A1)
		MOVE 28(A0),D5
		OR D5,280(A1)
		MOVE 32(A0),D5
		OR D5,6(A3)
		MOVE 36(A0),D5
		OR D5,46(A3)
		MOVE 40(A0),D5
		OR D5,86(A3)
		MOVE 44(A0),D5
		OR D5,126(A3)
		MOVE 48(A0),D5
		OR D5,166(A3)
		MOVE 52(A0),D5
		OR D5,206(A3)
		MOVE 56(A0),D5
		OR D5,246(A3)
		MOVE 60(A0),D5
		OR D5,286(A3)
		MOVE 64(A0),D5
		OR D5,326(A3)
		MOVE 68(A0),D5
		OR D5,366(A3)
		MOVE 72(A0),D5
		OR D5,406(A3)
		MOVE 76(A0),D5
		OR D5,446(A3)
		MOVE 80(A0),D5
		OR D5,486(A3)
		MOVE 84(A0),D5
		OR D5,526(A3)
		MOVE 88(A0),D5
		OR D5,566(A3)
		MOVE 92(A0),D5
		OR D5,606(A3)
		MOVE 96(A0),D5
		OR D5,646(A3)
		MOVE 100(A0),D5
		OR D5,686(A3)
		MOVE 104(A0),D5
		OR D5,726(A3)
		MOVE 108(A0),D5
		OR D5,766(A3)
		MOVE 112(A0),D5
		OR D5,806(A3)
		MOVE 116(A0),846(A3)
		MOVE 120(A0),886(A3)
		MOVE 124(A0),926(A3)
		MOVE 128(A0),966(A3)
		MOVE 132(A0),1006(A3)
		MOVE 136(A0),1046(A3)
		MOVE 140(A0),1086(A3)
		MOVE 144(A0),1126(A3)

* Copy relevant pieces of the
* buffer onto the screen.

CON1		MACRO
		MOVEM.W (A0),D0-D4
		MOVE D0,(A1)
		MOVE D0,(A3)
		MOVE D0,12800(A1)
		MOVE D0,12800(A3)
		MOVE D1,8(A1)
		MOVE D1,8(A3)
		MOVE D1,12808(A1)
		MOVE D1,12808(A3)
		MOVE D2,16(A1)
		MOVE D2,16(A3)
		MOVE D2,12816(A1)
		MOVE D2,12816(A3)
		MOVE D3,24(A1)
		MOVE D3,24(A3)
		MOVE D3,12824(A1)
		MOVE D3,12824(A3)
		MOVE D4,32(A1)
		MOVE D4,32(A3)
		MOVE D4,12832(A1)
		MOVE D4,12832(A3)
		IFC '\2','0'
		LEA 160(A1),A1
		LEA -160(A3),A3
		LEA \1(A0),A0
		ELSEIF
		LEA 168(A1),A1
		LEA -152(A3),A3
		LEA \1+2(A0),A0
		ENDC
		ENDM
DCON1		MACRO
		MOVEM.W (A0),D0-D4
		MOVE D0,(A1)
		MOVE D0,(A3)
		MOVE D0,12800(A1)
		MOVE D0,12800(A3)
		MOVE D1,8(A1)
		MOVE D1,8(A3)
		MOVE D1,12808(A1)
		MOVE D1,12808(A3)
		MOVE D2,16(A1)
		MOVE D2,16(A3)
		MOVE D2,12816(A1)
		MOVE D2,12816(A3)
		MOVE D3,24(A1)
		MOVE D3,24(A3)
		MOVE D3,12824(A1)
		MOVE D3,12824(A3)
		MOVE D4,32(A1)
		MOVE D4,32(A3)
		MOVE D4,12832(A1)
		MOVE D4,12832(A3)
		MOVE D0,160(A1)
		MOVE D0,-160(A3)
		MOVE D0,12800+160(A1)
		MOVE D0,12800-160(A3)
		MOVE D1,168(A1)
		MOVE D1,8-160(A3)
		MOVE D1,12808+160(A1)
		MOVE D1,12808-160(A3)
		MOVE D2,176(A1)
		MOVE D2,16-160(A3)
		MOVE D2,12816+160(A1)
		MOVE D2,12816-160(A3)
		MOVE D3,184(A1)
		MOVE D3,24-160(A3)
		MOVE D3,12824+160(A1)
		MOVE D3,12824-160(A3)
		MOVE D4,192(A1)
		MOVE D4,32-160(A3)
		MOVE D4,12832+160(A1)
		MOVE D4,12832-160(A3)
		IFC '\2','0'
		LEA 320(A1),A1
		LEA -320(A3),A3
		LEA \1(A0),A0
		ELSEIF
		LEA 328(A1),A1
		LEA -312(A3),A3
		LEA \1+2(A0),A0
		ENDC
		ENDM
		MOVE.L log_base(PC),A1
		LEA buffer(PC),A0
		LEA 6080(A1),A1
		LEA 10722(A1),A3
		CON1 200,0
		CON1 160,0
		CON1 120,0
		CON1 80,0
		CON1 80,0
		CON1 80,0
		CON1 80,0
		CON1 40,0
		CON1 80,0
		CON1 40,0
		CON1 80,0
		CON1 40,0
		CON1 40,0
		CON1 40,0
		DCON1 40,0
		CON1 40,0
		DCON1 40,0
		CON1 40,0
		DCON1 40,1
		CON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		CON1 40,1
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		DCON1 40,0
		CON1 40,0
		DCON1 40,0
		CON1 40,1
		DCON1 40,0
		CON1 40,0
		DCON1 40,0
		CON1 40,0
		CON1 40,0
		CON1 80,1
		CON1 40,0
		CON1 80,0
		CON1 40,0
		CON1 80,0
		CON1 80,0
		CON1 80,0
		CON1 120,1
		CON1 80,0
		CON1 160,0
		CON1 200,0
CON2		MACRO
		MOVEM.W (A0),D0-D4
		MOVE D0,(A1)
		MOVE D0,(A3)
		MOVE D0,12800(A1)
		MOVE D0,12800(A3)
		MOVE D1,8(A1)
		MOVE D1,8(A3)
		MOVE D1,12808(A1)
		MOVE D1,12808(A3)
		MOVE D2,16(A1)
		MOVE D2,16(A3)
		MOVE D2,12816(A1)
		MOVE D2,12816(A3)
		MOVE D3,24(A1)
		MOVE D3,24(A3)
		MOVE D3,12824(A1)
		MOVE D3,12824(A3)
		MOVE D4,32(A1)
		MOVE D4,32(A3)
		MOVE D4,12832(A1)
		MOVE D4,12832(A3)
		IFC '\2','0'
		LEA 160(A1),A1
		LEA -160(A3),A3
		LEA \1(A0),A0
		ELSEIF
		LEA 168(A1),A1
		LEA -152(A3),A3
		LEA \1+2(A0),A0
		ENDC
		ENDM
DCON2		MACRO
		MOVEM.W (A0),D0-D4
		MOVE D0,(A1)
		MOVE D0,(A3)
		MOVE D0,12800(A1)
		MOVE D0,12800(A3)
		MOVE D1,8(A1)
		MOVE D1,8(A3)
		MOVE D1,12808(A1)
		MOVE D1,12808(A3)
		MOVE D2,16(A1)
		MOVE D2,16(A3)
		MOVE D2,12816(A1)
		MOVE D2,12816(A3)
		MOVE D3,24(A1)
		MOVE D3,24(A3)
		MOVE D3,12824(A1)
		MOVE D3,12824(A3)
		MOVE D4,32(A1)
		MOVE D4,32(A3)
		MOVE D4,12832(A1)
		MOVE D4,12832(A3)
		MOVE D0,160(A1)
		MOVE D0,-160(A3)
		MOVE D0,12800+160(A1)
		MOVE D0,12800-160(A3)
		MOVE D1,168(A1)
		MOVE D1,8-160(A3)
		MOVE D1,12808+160(A1)
		MOVE D1,12808-160(A3)
		MOVE D2,176(A1)
		MOVE D2,16-160(A3)
		MOVE D2,12816+160(A1)
		MOVE D2,12816-160(A3)
		MOVE D3,184(A1)
		MOVE D3,24-160(A3)
		MOVE D3,12824+160(A1)
		MOVE D3,12824-160(A3)
		MOVE D4,192(A1)
		MOVE D4,32-160(A3)
		MOVE D4,12832+160(A1)
		MOVE D4,12832-160(A3)
		IFC '\2','0'
		LEA 320(A1),A1
		LEA -320(A3),A3
		LEA \1(A0),A0
		ELSEIF
		LEA 328(A1),A1
		LEA -312(A3),A3
		LEA \1+2(A0),A0
		ENDC
		ENDM
		MOVE.L log_base(PC),A1
		LEA buffer+14(PC),A0
		LEA 6080+56(A1),A1
		LEA 10722(A1),A3
		CON2 200,0
		CON2 160,0
		CON2 120,1
		CON2 80,0
		CON2 80,0
		CON2 80,1
		CON2 80,0
		CON2 40,0
		CON2 80,0
		CON2 40,0
		CON2 80,0
		CON2 40,1
		CON2 40,0
		CON2 40,0
		DCON2 40,0
		CON2 40,0
		DCON2 40,0
		CON2 40,0
		DCON2 40,0
		CON2 40,0
		DCON2 40,0
		DCON2 40,1
		DCON2 40,0
		DCON2 40,0
		DCON2 40,0
		DCON2 00,0
		CON2 40,0
		DCON2 40,0
		DCON2 40,0
		DCON2 40,1
		DCON2 40,0
		DCON2 40,0
		CON2 40,0
		DCON2 40,0
		CON2 40,0
		DCON2 40,0
		CON2 40,1
		DCON2 40,0
		CON2 40,0
		CON2 40,0
		CON2 80,0
		CON2 40,0
		CON2 80,0
		CON2 40,1
		CON2 80,0
		CON2 80,0
		CON2 80,0
		CON2 120,1
		CON2 80,0
		CON2 160,0
		CON2 200,0

CON3		MACRO
		MOVEM.W (A0),D0-D2
		MOVE D0,(A1)
		MOVE D0,(A3)
		MOVE D0,12800(A1)
		MOVE D0,12800(A3)
		MOVE D1,8(A1)
		MOVE D1,8(A3)
		MOVE D1,12808(A1)
		MOVE D1,12808(A3)
		MOVE D2,16(A1)
		MOVE D2,16(A3)
		MOVE D2,12816(A1)
		MOVE D2,12816(A3)
		LEA 160(A1),A1
		LEA -160(A3),A3
		LEA \1(A0),A0
		ENDM				
		MOVE.L log_base(PC),A1
		LEA buffer+34(PC),A0
		LEA 6080+136(A1),A1
		LEA 10722(A1),A3
		CON3 200
		CON3 160
		CON3 120
		CON3 80
		CON3 80
		CON3 80
		CON3 80
		CON3 40
		CON3 80
		
* 80000 cycles left after 2 twist
* scrolls and music in vbl.
* This does the VU_METER.

Vu_meter	MOVE.L log_base(PC),A0
 		ADD.L #38240,A0
		MOVE.L #%00000000100000010000000000000000,D3
		MOVE.L #%01111110111111110111111001111110,D4
		MOVE.L #%01111110111111110111111000000000,D5
		MOVE #$8800,A1
chan_1	LEA 89(A0),A2
		LEA 64(A0),A3
		MOVE.B #8,(A1)
		MOVE.B (A1),D0
		AND #15,D0
		BSR do_vu
chan_2	LEA 1120(A0),A0
		LEA 89(A0),A2
		LEA 64(A0),A3
		MOVE.B #9,(A1)
		MOVE.B (A1),D0
		AND #15,D0
		BSR do_vu
chan_3	LEA 1120(A0),A0
		LEA 89(A0),A2
		LEA 64(A0),A3
		MOVE.B #10,(A1)
		MOVE.B (A1),D0
		AND #15,D0
		BSR do_vu

* This bit does the Resistance
* sprites in doc waves.		

Sprites	LEA xy_old1(PC),A3
		NOT switch
		BNE.S Clear_old
		LEA xy_old2(PC),A3
Clear_old	MOVE.L A3,A4
		MOVE.L log_base(PC),A1
		MOVEQ #0,D0
		MOVEQ #no_sprs-2,D7		
clear_lp	MOVE.L A1,A0
		ADDA (A3)+,A0
		MOVE.L D0,(A0)
		MOVE.L D0,8(A0)		
		MOVE.L D0,160(A0)
		MOVE.L D0,168(A0)
		MOVE.L D0,320(A0)
		MOVE.L D0,328(A0)
		MOVE.L D0,480(A0)
		MOVE.L D0,488(A0)
		MOVE.L D0,640(A0)
		MOVE.L D0,648(A0)
		MOVE.L D0,800(A0)
		MOVE.L D0,808(A0)
		MOVE.L D0,960(A0)
		MOVE.L D0,968(A0)
		MOVE.L D0,1120(A0)
		MOVE.L D0,1128(A0)
		MOVE.L D0,1280(A0)
		MOVE.L D0,1288(A0)
		MOVE.L D0,1440(A0)
		MOVE.L D0,1448(A0)
		MOVE.L D0,1600(A0)
		MOVE.L D0,1608(A0)
		MOVE.L D0,1760(A0)
		MOVE.L D0,1768(A0)
		MOVE.L D0,1920(A0)
		MOVE.L D0,1928(A0)
		MOVE.L D0,2080(A0)
		MOVE.L D0,2088(A0)
		MOVE.L D0,2240(A0)
		MOVE.L D0,2248(A0)
		MOVE.L D0,2400(A0)
		MOVE.L D0,2408(A0)
next_cl	DBF D7,clear_lp		

Calc_new	LEA xy_pos(PC),A0
wave_selct	MOVE.L #wave1,A2
		LEA 1024(A2),A3
		LEA xy_new(PC),A5
		MOVE xinc(PC),D2
		MOVE yinc(PC),D3
		MOVE #$3FF,D4
		MOVEQ #no_sprs-1,D7
		MOVEQ #0,D5
		MOVEQ #0,D6
		MOVE xapart(PC),A1
		MOVE yapart(PC),A6
calc_lp	ADD A1,D5		add xapart
		ADD A6,D6		add yapart
		AND D4,D5
		AND D4,D6
		CMP #10,D7
		BEQ.S n1
		MOVE (A0),D0	get x pos
		ADD D2,D0		add xinc
		AND D4,D0
		MOVE D0,(A0)+
		MOVE (A0),D1	get y pos
		ADD D3,D1		add yinc
		AND D4,D1
		MOVE D1,(A0)+
		ADD D5,D0
		ADD D6,D1
		AND D4,D0
		AND D4,D1
		MOVE (A2,D0),(A5)+
		MOVE (A3,D1),(A5)+
n1		DBF D7,calc_lp

		MOVE.L log_base(PC),A3
		LEA sprite_no(PC),A6
		LEA xy_new(PC),A5
		MOVE #no_sprs-1,-(SP)
sprite_lp	MOVE (A5)+,D0
		MOVE (A5)+,D1
		MOVE.L (A6)+,A2				
		MOVE D0,D2
		LSR #1,D0
		AND.B #$F8,D0
		ADD D1,D0
		MOVE.L A3,A1
		ADDA D0,A1
		MOVE D0,(A4)+
		AND #15,D2
		LSL #8,D2
		ADDA D2,A2
		MOVEM.L (A2)+,D0-D7
		AND.L D0,(A1)
		OR.L D1,(A1)
		AND.L D2,8(A1)
		OR.L D3,8(A1)
		AND.L D4,160(A1)
		OR.L D5,160(A1)
		AND.L D6,168(A1)
		OR.L D7,168(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,320(A1)
		OR.L D1,320(A1)
		AND.L D2,328(A1)
		OR.L D3,328(A1)
		AND.L D4,480(A1)
		OR.L D5,480(A1)
		AND.L D6,488(A1)
		OR.L D7,488(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,640(A1)
		OR.L D1,640(A1)
		AND.L D2,648(A1)
		OR.L D3,648(A1)
		AND.L D4,800(A1)
		OR.L D5,800(A1)
		AND.L D6,808(A1)
		OR.L D7,808(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,960(A1)
		OR.L D1,960(A1)
		AND.L D2,968(A1)
		OR.L D3,968(A1)
		AND.L D4,1120(A1)
		OR.L D5,1120(A1)
		AND.L D6,1128(A1)
		OR.L D7,1128(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,1280(A1)
		OR.L D1,1280(A1)
		AND.L D2,1288(A1)
		OR.L D3,1288(A1)
		AND.L D4,1440(A1)
		OR.L D5,1440(A1)
		AND.L D6,1448(A1)
		OR.L D7,1448(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,1600(A1)
		OR.L D1,1600(A1)
		AND.L D2,1608(A1)
		OR.L D3,1608(A1)
		AND.L D4,1760(A1)
		OR.L D5,1760(A1)
		AND.L D6,1768(A1)
		OR.L D7,1768(A1)
		MOVEM.L (A2)+,D0-D7
		AND.L D0,1920(A1)
		OR.L D1,1920(A1)
		AND.L D2,1928(A1)
		OR.L D3,1928(A1)
		AND.L D4,2080(A1)
		OR.L D5,2080(A1)
		AND.L D6,2088(A1)
		OR.L D7,2088(A1)
		MOVEM.L (A2),D0-D7
		AND.L D0,2240(A1)
		OR.L D1,2240(A1)
		AND.L D2,2248(A1)
		OR.L D3,2248(A1)
		AND.L D4,2400(A1)
		OR.L D5,2400(A1)
		AND.L D6,2408(A1)
		OR.L D7,2408(A1)
next_spr	SUBQ #1,(SP)
		BNE sprite_lp
		LEA 2(SP),SP

* 32*32 scroller using 2 two screen
* trick - 12% processor time!

scroll32	MOVE.L scr_point32(PC),A0
		MOVE scrx32(PC),D0
		ADDQ #1,D0
		CMP #5,D0
		BLO.S not_next
		LEA 1(A0),A0
		MOVE.B 2(A0),D0
		BNE.S not_wrap
		LEA text(PC),A0
not_wrap	MOVE.L A0,scr_point32
		MOVEQ #1,D0
not_next	MOVE D0,scrx32
		CLR D1
		MOVE.B (A0),D1
		ADD D1,D1
		ADD D1,D1
		LEA char_tab1(PC),A1
		MOVE.L (A1,D1),A0
		MOVE.L log_base(PC),A1
		LEA 31192(A1),A1
		CMP #1,D0
		BEQ case_1
		CMP #2,D0
		BEQ case_2
		CMP #3,D0
		BEQ case_3
case_4	MOVE.L scr_point32(PC),A2
		CLR D0
		MOVE.B 1(A2),D0
		ADD D0,D0
		ADD D0,D0
		LEA char_tab1(PC),A2
		MOVE.L (A2,D0),A2
i		SET 0
j		SET 0
		REPT 31
		MOVEP.L i+9(A0),D0
		MOVEP.L D0,j(A1)
		MOVEP.L i(A2),D0
		MOVEP.L D0,j+1(A1)
i		SET i+16
j		SET j+160
		ENDR
		BRA Test_key
i		SET 0
j		SET 0
case_3	REPT 31
		MOVE.L i+8(A0),j(A1)
		MOVE.L i+12(A0),j+4(A1)
i		SET i+16
j		SET j+160
		ENDR
		BRA Test_key
i		SET 0
j		SET 0
case_2	REPT 31
		MOVEP.L i+1(A0),D0
		MOVEP.L D0,j(A1)
		MOVEP.L i+8(A0),D0
		MOVEP.L D0,j+1(A1)
i		SET i+16
j		SET j+160
		ENDR		
		BRA Test_key
i		SET 0
j		SET 0
case_1	REPT 31
		MOVE.L i(A0),j(A1)
		MOVE.L i+4(A0),j+4(A1)
i		SET i+16
j		SET j+160
		ENDR

* Scan the keyboard....

Test_key	BTST.B #0,$FFFFFC00.W
		BEQ VBLOOP
		MOVEQ #0,D0
		MOVE.B $FFFFFC02.W,D0
		CMP.B key_a(PC),D0
		BEQ VBLOOP
		MOVE.B D0,key_a
* Check for music selection
		CMP.B #$3B,D0
		BLO.S not_mus
		CMP.B #$3F,D0
		BHI.S not_mus
		SUB.B #$3A,D0
		CMP musplying(PC),D0
		BEQ.S not_mus
		MOVE D0,musplying
mus_sel	JSR mus 
* check for left arrow
not_mus	CMP.B #$4B,D0
		BNE.S no_left_arr
		LEA xinc(PC),A0
		MOVE (A0),D0
		SUBQ #2,D0
		AND #$3FF,D0
		MOVE D0,(A0)
		BRA VBLOOP
* check for right arrow
no_left_arr	CMP.B #$4D,D0
		BNE.S no_rigt_arr
		LEA xinc(PC),A0
		MOVE (A0),D0
		ADDQ #2,D0
		AND #$3FF,D0
xinc_ok2	MOVE D0,(A0)
		BRA VBLOOP
* check for uparrow
no_rigt_arr	CMP.B #$48,D0
		BNE.S no_up_arr
		LEA yinc(PC),A0
		MOVE (A0),D0
		SUBQ #2,D0
		AND #$3FF,D0
		MOVE D0,(A0)
		BRA VBLOOP
* check for down arrow
no_up_arr	CMP.B #$50,D0
		BNE.S no_down_arr
		LEA yinc(PC),A0
		MOVE (A0),D0
		ADDQ #2,D0
		AND #$3FF,D0
		MOVE D0,(A0)
		BRA VBLOOP
* check for keys 1-3
no_down_arr	CMP.B #$6D,D0
		BNE.S not_1
		MOVE.L #wave1,wave_selct+2
		MOVE #8,xinc
		MOVE #12,yinc
		MOVE #24,xapart
		MOVE #24,yapart
		BRA VBLOOP
not_1		CMP.B #$6E,D0
		BNE.S not_2
		MOVE.L #wave2,wave_selct+2
		MOVE #4,xinc
		MOVE #6,yinc
		MOVE #16,xapart
		MOVE #16,yapart
		BRA VBLOOP
not_2		CMP.B #$6F,D0
		BNE.S not_3
		MOVE.L #wave3,wave_selct+2
		MOVE #4,xinc
		MOVE #6,yinc
		MOVE #24,xapart
		MOVE #24,yapart
		BRA VBLOOP
* check for space - exit
not_3		CMP.B #$39,D0
		BNE VBLOOP	

* Exit routine - restore everything.

the_end	MOVEQ #0,D0
		JSR mus
		MOVE #$8240,A0
		MOVEQ #7,D0
clr_cllp	CLR.L (A0)+
		DBF D0,clr_cllp
		LEA $6A000,A0
		MOVE #12239,D0
clr_slp1	CLR.L (A0)+
		CLR.L (A0)+
		DBF D0,clr_slp1
		MOVE SR,-(SP)
		MOVE #$2700,SR
		LEA old_mfp,A0
		MOVE.B #$08,$FFFFFC02.W
		MOVE.L old_base(PC),$FFFF8200.W
		MOVE.B (A0)+,$FFFFFA07.W
		MOVE.B (A0)+,$FFFFFA09.W
		MOVE.B (A0)+,$FFFFFA13.W
		MOVE.B (A0)+,$FFFFFA15.W
		MOVE.B (A0)+,$FFFFFA17.W
		MOVE.B (A0)+,$FFFFFA1B.W
		MOVE.B (A0)+,$FFFFFA21.W
		MOVE.L old_vbl(PC),$70.W
		BSR flush
		MOVE (SP)+,SR		
		MOVE #$777,$FFFF8240.W
		MOVE #$000,$FFFF825E.W
		MOVE.L oldssp(PC),-(SP)
		MOVE #$20,-(SP)
		TRAP #1
		ADDQ.L #6,SP	
		CLR -(SP)			the
		TRAP #1			end

* keyboard flush routine

flush		BTST.B #0,$FFFFFC00.W
		BEQ.S end_fl
		MOVE.B $FFFFFC02.W,D0
		BRA.S flush
end_fl	RTS

* Draw one vu-meter bar in segments
* of eight from 0 to D0.

do_vu		ADD D0,D0
		ADD D0,D0
		MOVE.L vu_vect(PC,D0),A4
		JMP (A4)
vu_vect	DC.L vu_0
		DC.L vu_1
		DC.L vu_2
		DC.L vu_3
		DC.L vu_4
		DC.L vu_5
		DC.L vu_6
		DC.L vu_7
		DC.L vu_8
		DC.L vu_9
		DC.L vu_10
		DC.L vu_11
		DC.L vu_12
		DC.L vu_13
		DC.L vu_14
		DC.L vu_15
vu_0		REPT 2
		MOVEP.L D3,(A2)
		MOVEP.L D3,(A3)
		MOVEP.L D3,7(A2)
		MOVEP.L D3,-7(A3)
		MOVEP.L D3,8(A2)
		MOVEP.L D3,-8(A3)
		MOVEP.L D3,15(A2)
		MOVEP.L D3,-15(A3)
		MOVEP.L D3,16(A2)
		MOVEP.L D3,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_1		REPT 2
		MOVEP.L D4,(A2)
		MOVEP.L D4,(A3)
		MOVEP.L D3,7(A2)
		MOVEP.L D3,-7(A3)
		MOVEP.L D3,8(A2)
		MOVEP.L D3,-8(A3)
		MOVEP.L D3,15(A2)
		MOVEP.L D3,-15(A3)
		MOVEP.L D3,16(A2)
		MOVEP.L D3,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_2		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D3,8(A2)
		MOVEP.L D3,-8(A3)
		MOVEP.L D3,15(A2)
		MOVEP.L D3,-15(A3)
		MOVEP.L D3,16(A2)
		MOVEP.L D3,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_3		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D3,15(A2)
		MOVEP.L D3,-15(A3)
		MOVEP.L D3,16(A2)
		MOVEP.L D3,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_4		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D3,16(A2)
		MOVEP.L D3,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_5		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D3,23(A2)
		MOVEP.L D3,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_6		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D3,24(A2)
		MOVEP.L D3,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_7		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D3,31(A2)
		MOVEP.L D3,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_8		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D3,32(A2)
		MOVEP.L D3,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_9		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D3,39(A2)
		MOVEP.L D3,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_10		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D3,40(A2)
		MOVEP.L D3,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_11		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D4,40(A2)
		MOVEP.L D4,-40(A3)
		MOVEP.L D3,47(A2)
		MOVEP.L D3,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_12		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D4,40(A2)
		MOVEP.L D4,-40(A3)
		MOVEP.L D4,47(A2)
		MOVEP.L D4,-47(A3)
		MOVEP.L D3,48(A2)
		MOVEP.L D3,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_13		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D4,40(A2)
		MOVEP.L D4,-40(A3)
		MOVEP.L D4,47(A2)
		MOVEP.L D4,-47(A3)
		MOVEP.L D5,48(A2)
		MOVEP.L D5,-48(A3)
		MOVEP.L D3,55(A2)
		MOVEP.L D3,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_14		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D4,40(A2)
		MOVEP.L D4,-40(A3)
		MOVEP.L D4,47(A2)
		MOVEP.L D4,-47(A3)
		MOVEP.L D5,48(A2)
		MOVEP.L D5,-48(A3)
		MOVEP.L D5,55(A2)
		MOVEP.L D5,-55(A3)
		MOVEP.L D3,56(A2)
		MOVEP.L D3,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS
vu_15		REPT 2
		MOVEP.L D4,0(A2)
		MOVEP.L D4,0(A3)
		MOVEP.L D4,7(A2)
		MOVEP.L D4,-7(A3)
		MOVEP.L D4,8(A2)
		MOVEP.L D4,-8(A3)
		MOVEP.L D4,15(A2)
		MOVEP.L D4,-15(A3)
		MOVEP.L D4,16(A2)
		MOVEP.L D4,-16(A3)
		MOVEP.L D4,23(A2)
		MOVEP.L D4,-23(A3)
		MOVEP.L D4,24(A2)
		MOVEP.L D4,-24(A3)
		MOVEP.L D4,31(A2)
		MOVEP.L D4,-31(A3)
		MOVEP.L D4,32(A2)
		MOVEP.L D4,-32(A3)
		MOVEP.L D4,39(A2)
		MOVEP.L D4,-39(A3)
		MOVEP.L D4,40(A2)
		MOVEP.L D4,-40(A3)
		MOVEP.L D4,47(A2)
		MOVEP.L D4,-47(A3)
		MOVEP.L D5,48(A2)
		MOVEP.L D5,-48(A3)
		MOVEP.L D5,55(A2)
		MOVEP.L D5,-55(A3)
		MOVEP.L D5,56(A2)
		MOVEP.L D5,-56(A3)
		LEA 160(A2),A2
		LEA 160(A3),A3
		ENDR
		RTS

* Vbl routine to play music and
* set raster routines going etc...
		
my_vbl	MOVE #$2700,SR
		MOVEM.L D0-D7/A0-A6,-(SP)
		ADDQ #1,vbl_tmr
		MOVE #colours-hbl_1-2,hbl_1+2
		CLR.B $FFFFFA1B.W
		MOVE.L #start_hbl,$120.W
		MOVE.B #34,$FFFFFA21.W
		MOVE.B #8,$FFFFFA1B.W
		MOVE.L log_base(PC),A0
		LEA 31040(A0),A0
		REPT 24
		LEA 8(A0),A0
		MOVEM.L (A0)+,D0-D7/A2-A6
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A6
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A5
		MOVEM.L D0-D7/A2-A5,-56(A0)
		ENDR
		LEA 8(A0),A0
		MOVEM.L (A0)+,D0-D7/A2-A6
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A6
		DCB.W 20,$4E71
		MOVE.B #0,$ffff820a.w
		DCB.W 6,$4E71
		MOVE.B #2,$ffff820a.w
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A5
		MOVEM.L D0-D7/A2-A5,-56(A0)
		REPT 6
		LEA 8(A0),A0
		MOVEM.L (A0)+,D0-D7/A2-A6
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A6
		MOVEM.L D0-D7/A2-A6,-60(A0)
		MOVEM.L (A0)+,D0-D7/A2-A5
		MOVEM.L D0-D7/A2-A5,-56(A0)
		ENDR
		BSR mus+8
		MOVEM.L (SP)+,D0-D7/A0-A6
		RTE

start_hbl	CLR.B $FFFFFA1B.W
		MOVE.L #$05000500,$FFFF8248.W
		MOVE.L #$05000500,$FFFF824C.W
		MOVE.L #$07400740,$FFFF8250.W
		MOVE.L #$07400740,$FFFF8254.W
		MOVE.L #$01110111,$FFFF8258.W
		MOVE.L #$01110111,$FFFF825C.W
		MOVE.L #hbl_1,$120.W
		MOVE.B #4,$FFFFFA21.W
		MOVE.B #8,$FFFFFA1B.W
		RTE

hbl_1		MOVE.L colours(PC),$FFFF8242.W
		BMI new_hbl
		MOVE.W $FFFF8242.W,$FFFF8246.W
		ADDQ #4,hbl_1+2
		RTE
colours	DC.W $330,$200,$330,$300,$440,$400,$550,$500,$660,$600,$770,$700
		DC.W $770,$700,$770,$700,$770,$700,$770,$700,$770,$700
		DC.W $770,$700,$660,$600,$550,$500,$440,$400,$330,$300,$330,$200
		DC.W 0,0,0,0,0,0
		DC.W $330,$020,$330,$030,$440,$040,$550,$050,$660,$060,$770,$070
		DC.W $770,$070,$770,$070,$770,$070,$770,$070,$770,$070
		DC.W $770,$070,$660,$060,$550,$050,$440,$040,$330,$030,$330,$020
endc		DC.W -1
new_hbl	CLR.B $FFFFFA1B.W
		MOVE.L #hbl_2,$120.W
		MOVE.B #8,$FFFFFA21.W
		MOVE.B #8,$FFFFFA1B.W
		RTE				
		
hbl_2		MOVE.L A0,-(SP)
		MOVE #$8240,A0
		MOVE.L #$00000011,(A0)+
		MOVE.L #$01220233,(A0)+
		MOVE.L #$01100221,(A0)+
		MOVE.L #$03320100,(A0)+
		MOVE.L #$02110322,(A0)+
		MOVE.L #$00100121,(A0)+
		MOVE.L #$02320444,(A0)+
		MOVE.L #$03330555,(A0)+
		CLR.B $FFFFFA1B.W
		MOVE.L #hbl_3,$120.W
		MOVE.B #34,$FFFFFA21.W
		MOVE.B #8,$FFFFFA1B.W
		MOVE.L (SP)+,A0
		RTE

hbl_3		MOVE D0,-(SP)
		MOVE.L A0,-(SP)
		MOVE #$FA21,A0
		MOVE.B (A0),D0
no_change	CMP.B (A0),D0
		BEQ.S no_change
		CLR.B $FFFF820A.W
		DCB.W 11,$4E71
		MOVE #$600,$FFFF824E.W
		MOVE.B #2,$FFFF820A.W
		MOVE.L (SP)+,A0
		MOVE (SP)+,D0
		RTE

no_sprs	EQU 14
xy_pos	DS.L 14
xy_old1	DCB.W 14,16000
xy_old2	DCB.W 14,16000
switch	DC.W 0
xinc		DC.W 8
yinc		DC.W 12
xapart	DC.W 24
yapart	DC.W 24
xy_new	DS.L 14
sprite_no	DC.L sprite_buf+28672
		DC.L sprite_buf+4096
		DC.L sprite_buf+8192
		DC.L sprite_buf+16384
		DC.L sprite_buf+8192
		DC.L sprite_buf+20480
		DC.L sprite_buf+24576
		DC.L sprite_buf+20480
		DC.L sprite_buf+28672
		DC.L sprite_buf
		DC.L sprite_buf+32768
		DC.L sprite_buf+36864
		DC.L sprite_buf+8192
musplying	DC.W 2
key_a		DC.W 0
vbl_tmr	DC.W 0
oldssp	DC.L 0
old_vbl	DC.L 0
old_mfp	DS.L 4
old_base	DC.L 0
log_base	DC.L $6A000
phy_base	DC.L $75000
Scr_point	DC.L Scrolline
Fonttype	DC.L FONT1
Char_offset	DS.W 96
char_tab1	DS.L 92
scr_point32	DC.L text
scrx32	DC.W 0
text		DC.B "     .$.$.$.$. HI THERE! DID YOU LIKE THOSE SILLY SYMBOLS? $ $ $ NO? AWW, DON'T "
		DC.B "BE LIKE THAT!.......MASTER HERE, AT THE KEYBOARD AND ALL BY MYSELF IN THIS "
		DC.B "SCROLLER WHICH DOESN'T TWIST! WELL THIS REALLY IS A GREAT DEMOSCREEN (WHAT ELSE "
		DC.B "WOULD I SAY!!!!), THIS IS THE VERY FIRST RELEASED BY + RESISTANCE TO THE WIDE "
		DC.B "WORLD. THE MEMBERS OF THE RESISTANCE ARE: GRIFF (SUPERB CODING),GAZZA "
		DC.B "(SCROLLTEXTS, PR AND CODING), MASTER (GRAFIX). "
		DC.B "TO CONTACT US (AND DO CONTACT US!), WRITE TO + RESISTANCE, 8 ELMHURST AVENUE, "
		DC.B "MITCHAM, SURREY, ENGLAND, CR4 2HN.... OR .... + RESISTANCE, "
		DC.B "77 STRANRAER ROAD, PEMBROKE DOCK, DYFED, SW WALES,SA72 6RZ.... YOU WILL GET A "
		DC.B "QUICK REPLY TOO!!...        RIGHT THEN, THIS IS OUR OFFERING TO THE LOST BOYS' "
		DC.B 34," MINDBOMB ",34," DEMO,(SYMBOLS FOR THAT TOO!!).    FOR THIS SCROLLTEXT I THINK I WILL "
		DC.B "TALK ABOUT YOU..........THERE THAT'S ENOUGH OF THAT, ONTO BETTER THINGS LIKE........"
		DC.B "YES,YOU'VE GOT IT IN TWO,IT'S THE GREATEST THING SINCE YOU BOUGHT THE MACHINE THIS IS "
		DC.B "RUNNING ON........THE GREETINGS! IN NO SPECIAL ORDER.... + LOST BOYS(FOR MAKING THIS "
		DC.B 34," DEMO AND ANYONE ELSE INVOLVED!!), + ST SQUAD (HI ARCHIE, MATRIXX, ED, ALBA, MASTER(ME!!)), "
		DC.B " ELECTRONIC IMAGES (HIYA COUNT, PHANTOM, GIZMO AND ALL!), DYNAMIC DUO (HI-TECH, SHADOW), "
		DC.B "+ UNION (TEX, TCB, LEVEL 16, DELTA FORCE, TNT-CREW, + REPLICANTS, AND SOFTRUNNER GROUP), "
		DC.B "MADMAX THE BEST ON AN ST FOR MUSIX, ST-NEWS (RICHARD KARSMAKERS, STEFAN POSTHUMA), "
		DC.B "CONSTELLATIONS, SYNC, LEGEND, OMEGA, PHALLANX, + ALLIANCE, AENIGMATICA,ANTISOCIALS, "
		DC.B "AUTOMATION, BBC, MEDWAY BOYS, RADICAL SYSTEMS, SAS, MAD, SSR,ELEKTRA, AND MONTY... "
		DC.B "AND TO ALL THE BULLETIN BOARDS I'M ON: PENTHOUSE, DOMAIN, TWILIGHTZONE, MY LITTLE PHONEY, "
		DC.B "STARBASE ONE, LIGHTFINGERS, STUN, SCARY MONSTER, BITMAP BROS', HACKERNET, AND TO ANY THAT I "
		DC.B "MISSED....(YOU INCLUDED!).....        LOOK OUT FOR + L.U.S.H DEMO COMING SOON FROM + RESISTANCE!!.. "
		DC.B "ALSO WATCH OUT FOR A DEMO BY + RESISTANCE, ST SQUAD, ELECTRONIC IMAGES AND DYNAMIC DUO!...   "
		DC.B "  BEFORE YOU GO, READ THE ABOVE TWISTSCROLL AND PLAY WITH THE SPRITES.....THEN HAVE A GREAT DAY "
		DC.B "(OR NIGHT!).......OK, SO IT WAS A BORING SCROLLER, BUT WHO CARES, 'COS WE'RE GONNA WRAP NOW....            % % % ! "
		DC.B "BYE FROM MASTER......WRAP...........                ",0
		EVEN
Scrolline	DC.B "                      ",0
		DC.B " ......................OH NO! THE TWIST SCROLLER RETURNS............   "
		DC.B " YO! THE RESISTANCE PROUDLY PRESENT      - THE TWISTSCROLL 2 -     NOT BAD FOR A FIRST DEMO EH?  FIRST OF ALL THE CREDITS.    ALL CODING BY THE MEGAMIGHTY GRIFF... GRAPHIX BY MASTER,GENERAL ORGANISATION AND CRITICISM BY GAZZA....."
		DC.B " THE MUSIC WAS RIPPED FROM 5TH GEAR AND IS BY MADMAX (THE BEST MUSIC MAN ON THE ST BY FAR). FIRST SOME INSTRUCTIONS...... THE SPRITES CAN BE CONTROLLED BY USING THE ARROW KEYS AND KEYS 1 TO 3 ON THE KEYPAD FOR DIFFERENT WAVEFORMS....."
		DC.B " YOU CAN CHOOSE BETWEEN THE FIVE TUNES BY PRESSING F1 TO F5 (THE 2ND TUNE IS OUR FAVOURITE,ITS REALLY CATCHY!)......"
		DC.B " EVERYONE EXCEPT GAZZA HATES READING GREETINGS SO I THINK I'LL LEAVE THEM TO THE END.   THIS DEMO WAS"
		DC.B " WRITTEN AFTER MEETING THE LOST BOYS AT THE PC SHOW IN SEPTEMBER'89 AND BEING ASKED TO WRITE A SCREEN FOR THE MINDBOMB DEMO.....THIS IS THE RESULT OF ABOUT 25 HOURS HARD CODING SPREAD OVER MANY WEEKS. NOW WE HAVE FINISHED THIS WE ARE"
		DC.B " GOING TO GET DOWN TO SOME SERIOUS DEMO WRITING. THIS SCREEN IS NOT PARTICULARLY REVOLUTIONARY BUT CONTAINS QUITE A LOT OF MOVEMENT AND LOOKS QUITE NICE. HOWEVER OUR NEXT DEMO CALLED THE L.U.S.H DEMO WILL BE WELL'ARD!!!"
		DC.B " THE L.U.S.H DEMO MAY EVEN HAVE A FEW EFFECTS UNSEEN BEFORE...........  YOU MIGHT KNOW THIS ALREADY BUT THE RESISTANCE,ST SQUAD,ELECTRONIC IMAGES AND THE DYNAMIC DUO HAVE JOINED TOGETHER TO FORM A GROUP CALLED THE INNER CIRCLE."
		DC.B " WE ALL MET TOGETHER OVER THE NEW YEAR AT E.I.'S HEADQUARTERS TO START WORKING ON OUR NEW DEMO TO BE RELEASED SOON....."
		DC.B " WE ALL HAD A GREAT TIME AND SPENT TIME CODING ,EATING ,DRINKING, PLAYING GAMES (YES WE DO PLAY GAMES!!), PLAYING MIDI-MAZE(GREAT GAME FOR MULTI-PLAYING(MASTER WAS THE BEST.WE'LL BEAT U NEXT TIME!! )) AND GENERALLY HAVING ONE HELL OF"
		DC.B " OF A GREAT TIME (WE LOOK FORWARD TO OUR NEXT MEETING).......   AT THE MOMENT WE (GRIFF AND GAZZA) ARE TRYING TO THINK OF SOME INTERESTING STUFF TO WRITE FOR THIS SCROLL TEXT.NOW THAT WE ARE LOST FOR IDEAS.... HERE ARE THE GREETINGS!!"
		DC.B "    GREETINGS GO TO (IN NO SPECIAL ORDER)     THE LOST BOYS (HOPE U LIKE OUR SCREEN GUYS!), ELECTRONIC IMAGES (HI COUNT, PHANTOM, GIZMO (THE TWO PERVERTS!) AND NIGHT OWL), ST SQUAD (HEY ARCHIE! HOWS THE 3D SPRITES!!!), TEX(GREAT GAME)" "
		DC.B " ,  THE CAREBEARS (NOT BAD DEMOS GUYS!!!), TNT-CREW (GREAT 3D ROUTINES!), LEVEL 16 , AUTOMATION (THANX FOR ALL YOUR CD'S. YOUR "
		DC.B "THE BEST!!), THE REPLICANTS (NICE CRACKS), OVERLANDERS , 42-CREW , SYNC , OMEGA , AAC , LEGEND , FLEXIBLE FRONT , PHALLANX (ALL MEMBERS) , DYNAMIC DUO , MCA , THE VISION , DIGITAL INSANITY (WE MET AT PC SHOW. REMEMBER??) , "
		DC.B " JOHN LOOKER(HOW R U?) , ODD-BALL (BBS - 01 679 2583 ) , STEVEN GREEN (MY LITTLE PHONEY BBS - 0865 773277 ) , WALLY (DAVE.WILL U EVER FORGIVE GRIFF?! THANX FOR ALL THE STUFF ANYWAY!) , JOHN (HOW IS TBMD GOING?"
		DC.B " MADE ANY GOOD DEMOS YET?!!!) , MIKE (MR GULLABLE HIMSELF!!!!(SORRY) , WALLY BEBEN (HAGAR. WHERES THE MUSIC U PROMISED?)  THINK THATS ALL..... SORRY IF WE MISSED ANYONE(WILL U FORGIVE US??!)....... WELL THAT'S JUST ABOUT IT FOR"
		DC.B " THIS DEMO.I THINK ITS TIME TO WRAP..........."
		DC.B "                        ",0
		EVEN 
led		INCBIN LEDBLOCK.DAT
buffer	INCBIN TWISTFNT.DAT
twist_logo	INCBIN TWSTLOGO.DAT
sprites	INCBIN SPRITES.DAT
wave1		INCBIN 1.WF
wave2		INCBIN 2.WF
wave3		INCBIN 3.WF
mus		INCBIN 5TH_GEAR.MUS
font32	INCBIN TWSTFN32.DAT
		EVEN
FONT1		
FONTEND	EQU FONT1+69120
sprite_buf	EQU FONTEND


