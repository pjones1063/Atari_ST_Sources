**************************************
*** CONVERTION PALETTE D'UNE IMAGE ***
*** FORMAT TPI OU PNT 256 COULEURS ***
*** (C) 1994 , ZANAK from ATROCITY ***
**************************************


	OPT	O+
	
	SECTION TEXT
	
SUPER	PEA	0.W
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

STOCKAGE_DE_LA_PALETTE

	LEA.L	PALETTE,A0
	LEA.L	IMAGE,A1
	LEA.L	FORMAT_TPI,A2
	MOVE.L	#$F,D1
	CLR.B	D2
STOCK	BSR.S	POINTAGE
	BSR.S	CONVERTION
	CMP.B	#1,D2
	BEQ.S	FIN
	DBF	D1,STOCK
	BSR.S	POINTAGE
	MOVE.W	#$EE,D1
STOCK2	BSR.S	CONVERTION
	DBF	D1,STOCK2
	BSR.S	POINTAGE
	MOVE.B	#1,D2
	BRA	STOCK
	
FIN	CLR	-(SP)
	TRAP	#1		
	
POINTAGE	MOVE.W	(A2)+,D0
	ADDA.L	D0,A1
	RTS
	
CONVERTION	BSR.S	CONVERTION1	; ROUGE
	BSR.S	CONVERTION1	; VERT
	CLR.B	(A0)+	; NUL
	BSR.S	CONVERTION1	; BLEU
	RTS
	
CONVERTION1	MOVE.W	(A1)+,D0
	LSR.W	#4,D0
	LSL.W	#2,D0
	MOVE.B	D0,(A0)+
	RTS
	
	SECTION DATA
	
*** CODAGE DE LA COULEUR TPI : 0 -> 15 ***

FORMAT_TPI	DC.W	$128,$140,$146,$164,$152,$170,$158,$176
	DC.W	$182,$188,$194,$212,$200,$218,$206,$1658,$224,$134
	
IMAGE	INCBIN	D:\DIVERS\IMAGES\ATROCITY.TPI
	EVEN
	
	SECTION BSS
	
PALETTE	DS.L	256