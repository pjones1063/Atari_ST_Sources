************************************
*** Configuration Lecteur A et B ***
*** Coded By ZANAK from ATROCITY ***
***          CORPORATION         ***
************************************

	OPT	O+

FDC_CON	EQU	$FFFF8606
FDC_REG	EQU	$FFFF8604


	SECTION TEXT
	
SUPER	PEA	0.W
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#2,SP

TEXTE	PEA	TEXT(PC)
	MOVE.W	#9,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
WAIT_K	MOVE.W	#2,-(SP)
	MOVE.W	#1,-(SP)
	TRAP	#13
	ADDQ.L	#4,SP
	
	TST.W	D0
	BEQ.S	WAIT_K
	
	MOVE.W	#7,-(SP)
	TRAP	#1
	ADDQ.L	#2,SP
	
	SWAP	D0
	
	CMP.W	#$3B,D0	;F1
	BEQ.S	AF1	
	CMP.W	#$3C,D0	;F2
	BEQ.S	AF2	
	CMP.W	#$3D,D0	;F3
	BEQ	AF3	
	CMP.W	#$3E,D0	;F4
	BEQ	AF4	
	CMP.W	#$3F,D0	;F5
	BEQ	BF1	
	CMP.W	#$40,D0	;F6
	BEQ	BF2	
	CMP.W	#$41,D0	;F7
	BEQ	BF3	
	CMP.W	#$42,D0	;F8
	BEQ	BF4	
	CMP.W	#$43,D0	;F9
	BEQ	QUIT	
	BRA.S	WAIT_K
	
AF1	MOVE.B	#0,D3		; LECTEUR A
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	CLR.W	FDC_REG
	PEA	ADEUX(PC)
	BRA	PRINT

AF2	MOVE.B	#0,D3		; LECTEUR A
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#1,FDC_REG
	PEA	ATROIS(PC)
	BRA	PRINT

AF3	MOVE.B	#0,D3		; LECTEUR A
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#2,FDC_REG
	PEA	ACINQ(PC)
	BRA	PRINT

AF4	MOVE.B	#0,D3		; LECTEUR A
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#3,FDC_REG
	PEA	ASIX(PC)
	BRA	PRINT

BF1	MOVE.B	#1,D3		; LECTEUR B
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	CLR.W	FDC_REG
	PEA	BDEUX(PC)
	BRA	PRINT

BF2	MOVE.B	#1,D3		; LECTEUR B
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#1,FDC_REG
	PEA	BTROIS(PC)
	BRA	PRINT

BF3	MOVE.B	#1,D3		; LECTEUR B
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#2,FDC_REG
	PEA	BCINQ(PC)
	BRA	PRINT

BF4	MOVE.B	#1,D3		; LECTEUR B
	MOVE.B	#0,D4		; FACE 0
	BSR	DRIVE
	MOVE.W	#$80,FDC_CON
	MOVE.W	#3,FDC_REG
	PEA	BSIX(PC)
	BRA	PRINT
	
PRINT	MOVE.W	#9,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	BRA	WAIT_K	
	
QUIT	MOVE.W	#0,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR	-(SP)
	TRAP	#1

DRIVE	ADDQ.B	#1,D3		
	ADD.B	D3,D3
	OR.B	D4,D3
	EOR.B	#7,D3
	MOVE.B	#14,$FFFF8800.W
	MOVE.B	$FFFF8800.W,D4
	AND.B	#$F8,D4
	OR.B	D3,D4
	MOVE.B	D4,$FFFF8802.W
	RTS
		
	SECTION DATA
		
TEXT	DC.B	27,"E","*** ZANAK SPEED-DRIVE SELECT ***",10,13,10,13
	DC.B	"  LECT A :   F1 - 2 ms",10,13
	DC.B	"             F2 - 3 ms",10,13
	DC.B	"             F3 - 5 ms",10,13
	DC.B	"             F4 - 6 ms",10,13,10,13
	DC.B	"  LECT B :   F5 - 2 ms",10,13
	DC.B	"             F6 - 3 ms",10,13
	DC.B	"             F7 - 5 ms",10,13
	DC.B	"             F8 - 6 ms",10,13,10,13
	DC.B	"             F9 - QUIT",10,13,10,13,0 	
	
ADEUX	DC.B	27," LECTEUR A : 2 MS ",10,13,0
ATROIS	DC.B	27," LECTEUR A : 3 MS ",10,13,0
ACINQ	DC.B	27," LECTEUR A : 5 MS ",10,13,0
ASIX	DC.B	27," LECTEUR A : 6 MS ",10,13,0
BDEUX	DC.B	27," LECTEUR B : 2 MS ",10,13,0
BTROIS	DC.B	27," LECTEUR B : 3 MS ",10,13,0
BCINQ	DC.B	27," LECTEUR B : 5 MS ",10,13,0
BSIX	DC.B	27," LECTEUR B : 6 MS ",10,13,0

	SECTION BSS
	
	EVEN
STOCK	DS.L	1

	END