*** FADE 256 COULEURS - TEST 2 ***
*** (C) 1994, ZANAK / ATROCITY ***

	OPT	O+
	
	SECTION TEXT
	
SUPER	PEA	0.W
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	BSR.S	PREPARATION_DE_LA_PALETTE

AFFICHE_IMAGE	LEA	IMAGE,A0
	MOVEA.L	$44E,A1
	MOVE.W	#32000,D0
	SUB.W	#1664,A1
AFFICHE1	MOVE.W	(A0)+,(A1)+
	DBF	D0,AFFICHE1
	
COULEUR	LEA	PALETTE,A0
	LEA	$FFFF9800.W,A1
	MOVE.L	#$FF,D0
COULEUR1	MOVE.L	(A0)+,(A1)+
	DBF	D0,COULEUR1
	
FIN	CMP.B	#$39,$FFFFFC02
	BNE	FIN	

	CLR	-(SP)
	TRAP	#1		

*************************************************
PREPARATION_DE_LA_PALETTE
	LEA.L	PALETTE,A0
	LEA.L	FORMAT_TPI,A2
	MOVE.L	#$F,D1
	CLR.B	D2
STOCK	BSR.S	POINTAGE
	BSR.S	CONVERTION
	CMP.B	#1,D2
	BEQ.S	AFFICHE_IMAGE
	DBF	D1,STOCK
	BSR.S	POINTAGE
	MOVE.W	#$EE,D1
STOCK2	BSR.S	CONVERTION
	DBF	D1,STOCK2
	BSR.S	POINTAGE
	MOVE.B	#1,D2
	BRA	STOCK
	RTS
		
POINTAGE	LEA.L	IMAGE,A1
	MOVE.W	(A2)+,D0
	ADDA.L	D0,A1
	RTS
	
CONVERTION	BSR.S	CONVERTION1	; ROUGE
	BSR.S	CONVERTION1	; VERT
	CLR.B	(A0)+	; NUL
	BSR.S	CONVERTION1	; BLEU
	RTS
	
CONVERTION1	MOVE.W	(A1)+,D0
	LSR.W	#4,D0
	LSL.W	#2,D0
	MOVE.B	D0,(A0)+
	RTS
	
*************************************************

	SECTION DATA
	
*** CODAGE DE LA COULEUR TPI : 0 -> 15 ***

FORMAT_TPI	DC.W	128,140,146,164,152,170,158,176
	DC.W	182,188,194,212,200,218,206,1658,224,134
	
IMAGE	INCBIN	E:\IMAGES\TPI.ZAK\ATROCITY.TPI
	EVEN
	
	SECTION BSS
	
PALETTE	DS.L	256