PRT_LINE x1k12                        зддддддддддддддддддддд©
                        Ё EXCEPTION PROCEDURE Ё
                        юддддддддддддддддддддды
EXCEPTION:
  move SR,SR_Saved
  set S
  clr T
  if Exception = Reset
  then RESET
  endif
  if Exception = Interrupt
  then move Interrupt_Pending_Level,I0_I1_I2
    if Exception = Auto_Vector_Interrupt
    then Vector# = 24+I0_I1_I2
    else (Exception=Non_Auto_Vector_Interrupt) MC68901 gives Vector#
    (if MC68901 non Reseted then Vector# = 15)
      if Bus Error
      then Vector# = 24 (Parasit Interrupt)
      endif
    endif
  else calculate Vector#
  endif
  mul #4,Vector#
  move.l PC,-(SSP)
  move SR_Saved,-(SSP)
  if Bus Error or Address Error
    if it is the 1rst Bus Error or Address Error
    then EXCEPTION
    else HALT
    endif
  endif
  if Exception = Bus Error or Address Error (cause to prefetch: PC=PC+2 ... +10)
    move Instruction_Register,-(SSP)
    move.l Fault_address,-(SSP)
    move Processor_State,-(SSP) (b0-b2=FC0-FC2  b3=I/N  b4=R/W)
       *FUNCTION CODES        FC2 FC1 FC0
        User Data              0   0   1
        User Programm          0   1   0
        Super Data             1   0   1
        Super Programm         1   1   0
        Interrupt Acknowledge  1   1   1
         -                       Other
       *I/N Instruction/exceptioN
        0: Instruction TRAP TRAPV CHK DIV0
        1: Reset Bus/Address_Error Trace Interrupt Illegal Line_A/F
           & Privilege_Violation
       *R/W  1:Read  0:Write
  endif
  move.l (Vector#),PC
  if Bus Error
    if it is the 1rst Bus Error or Address Error
    then EXCEPTION
    else HALT
    endif
  endif
  ...
RTE

HALT: wait RESET
RESET:
  move #%111,I0_I1_I2
  move #0,Vector#
  mul #4,Vector#
  move.l (Vector#),SSP
  move #1,Vector#
  mul #4,Vector#
  move.l (Vector#),PC
  ...
                             зддддддддддддддддддддддддддд©
                             Ё EXCEPTION PRIORITY LEVELS Ё
                зддддддддддддеддддддддддддддддддддддддддд╢
                Ё High level Ё    Reset                  Ё
                Ё            Ё    Bus Error              Ё
                Ё            Ё    Address Error          Ё
                Ё            Ё    Trace                  Ё
                Ё            Ё    Interrupt              Ё
                Ё            Ё    Illegal                Ё
                Ё            Ё    Line_A Line_F          Ё
                Ё            Ё    Privilege Violation    Ё
                Ё  Low level Ё    TRAP TRAPV CHK DIV0    Ё
                юддддддддддддаддддддддддддддддддддддддддды
                             зддддддддддддддддддддддддддд©
                             Ё INTERRUPT PRIORITY LEVELS Ё
зддддддддддддддддддддддддддддадддддддддддддддддддддддддддаддддддддддддддддддддд©
Ё          Interrupt if IPL2_IPL1_IPL0 >= I2_I1_I0 (Excepted for NMI)          Ё
цддддбддддбддддбддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁIPL2ЁIPL1ЁIPL0Ё                        Interrupt                              Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  1 Ё  1 Ё  1 Ё (Non Maskable Interrupt , Expand Port)                        Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  1 Ё  1 Ё  0 Ё MC68901                                                       Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  1 Ё  0 Ё  1 Ё (Expand Port)                                                 Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  1 Ё  0 Ё  0 Ё Vertival BLanking                                             Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  0 Ё  1 Ё  1 Ё (Expand Port)                                                 Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  0 Ё  1 Ё  0 Ё Horizontal BLanking                                           Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  0 Ё  0 Ё  1 Ё -                                                             Ё
цддддеддддеддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё  0 Ё  0 Ё  0 Ё No Interrupt                                                  Ё
юддддаддддаддддаддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
                                иммммммммммммммммммм╩
                                ╨ EXCEPTION VECTORS ╨
имммммммммямммммммммямммммммммммймммммммммммммммммммймммммммммммммммммммммммммм╩
╨Address $Ё Vector# Ё   Exception                                              ╨
гдддддддддедддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╤
╨     0/4 Ё     0/1 Ё   Reset SSP / PC                                         ╨
╨       8 Ё       2 Ё   Bus Error                                              ╨
╨       C Ё       3 Ё   Address Error                                          ╨
╨      10 Ё       4 Ё   Illegal Instructions                                   ╨
╨      14 Ё       5 Ё   DIV by 0 Instruction                                   ╨
╨      18 Ё       6 Ё   CHK Instruction                                        ╨
╨      1C Ё       7 Ё   TRAPV Instruction                                      ╨
╨      20 Ё       8 Ё   Privilege Violation                                    ╨
╨      24 Ё       9 Ё   Trace                                                  ╨
╨      28 Ё      10 Ё   $Axxx Instructions                                     ╨
╨      2C Ё      11 Ё   $Fxxx Instructions                                     ╨
╨   30-38 Ё   12-14 Ё   -                                                      ╨
╨      3C Ё      15 Ё   Non Reseted Interrupt                                  ╨
╨   40-5C Ё   16-23 Ё   -                                                      ╨
╨      60 Ё      24 Ё   Parasit Interrupt                                      ╨
╨      64 Ё      25 Ё   Auto_Vector Interrupt    #1= -                         ╨
╨      68 Ё      26 Ё   Auto_Vector Interrupt    #2= Horizontal BLanking       ╨
╨      6C Ё      27 Ё   Auto_Vector Interrupt    #3= -                         ╨
╨      70 Ё      28 Ё   Auto_Vector Interrupt    #4=   Vertical BLanking       ╨
╨   74-7C Ё   29-31 Ё   Auto_Vector Interrupt  #5-7= -                         ╨
╨   80-BC Ё   32-47 Ё   TRAP Instruction      #0-15                            ╨
╨   C0-FC Ё   48-63 Ё   -                                                      ╨
╨ 100-3FC Ё  64-255 Ё   Non_Auto_Vector Interrupts                             ╨
хмммммммммомммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪
